---
import BaseLayout from '../layouts/BaseLayout.astro';
import fs from 'node:fs';
import path from 'node:path';
import { parse } from 'yaml';
import index from '../../entities/index.json';

export async function getStaticPaths() {
  return index.map(entity => ({
    params: { slug: entity.slug }
  }));
}

const { slug } = Astro.params;
const entity = Object.values(index).find(e => e.slug === slug);
if (!entity) throw new Error(`Entity not found: ${slug}`);

const mdPath = path.resolve('./', entity.path);
const mdRaw = fs.readFileSync(mdPath, 'utf-8');
const [, yamlBlock, markdown] = mdRaw.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)/) || [];
const metadata = parse(yamlBlock || '');
---

<BaseLayout title={entity.name}>
	<h2>{entity.name}</h2>
	<p><strong>Type:</strong> {entity.type}</p>
	<p><strong>{markdown}</strong></p>
</BaseLayout>
